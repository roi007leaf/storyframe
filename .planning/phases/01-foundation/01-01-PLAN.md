---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - module.json
  - storyframe.mjs
  - lang/en.json
autonomous: true

must_haves:
  truths:
    - "Module loads in Foundry without manifest errors"
    - "Module initializes in correct hook sequence (init→setup→ready)"
    - "Module works with any Foundry system"
  artifacts:
    - path: "module.json"
      provides: "Valid v13 manifest with socketlib dependency"
      contains: "socketlib"
    - path: "storyframe.mjs"
      provides: "Main entry with hook sequence"
      contains: "Hooks.once"
    - path: "lang/en.json"
      provides: "English localization"
      contains: "storyframe"
  key_links:
    - from: "module.json"
      to: "storyframe.mjs"
      via: "esmodules field"
      pattern: "esmodules.*storyframe.mjs"
    - from: "module.json"
      to: "socketlib"
      via: "relationships.requires"
      pattern: "socketlib"
---

<objective>
Module scaffold with valid v13 manifest, ESModule entry, and hook initialization sequence.

Purpose: Establish bootable module that Foundry recognizes and initializes correctly. Foundation for StateManager and SocketManager.
Output: module.json (updated), storyframe.mjs (new), lang/en.json (new)
</objective>

<execution_context>
@/Users/roihorowitz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/roihorowitz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update module.json manifest</name>
  <files>module.json</files>
  <action>
Update existing module.json to v13-compliant manifest:

1. Keep existing: id, title, version, compatibility, authors
2. Add description: "GM journal reader with synchronized speaker portraits for players"
3. Add esmodules: ["storyframe.mjs"]
4. Add relationships.requires: [{ "id": "socketlib", "type": "module" }]
5. Add socket: true
6. Add languages: [{ "lang": "en", "name": "English", "path": "lang/en.json" }]

AVOID:
- minimumCoreVersion (deprecated, use compatibility object - already present)
- dependencies field (deprecated, use relationships)
- scripts field (use esmodules for ESModule format)

Result: Valid JSON that Foundry accepts without warnings.
  </action>
  <verify>
- JSON syntax valid: `cat module.json | jq .`
- Contains socketlib dependency: `grep -q "socketlib" module.json`
- Contains esmodules: `grep -q "esmodules" module.json`
  </verify>
  <done>
- module.json is valid JSON
- socketlib listed in relationships.requires
- storyframe.mjs listed in esmodules
- socket: true present
- No deprecated fields (minimumCoreVersion, dependencies)
  </done>
</task>

<task type="auto">
  <name>Task 2: Create main entry and hook initialization</name>
  <files>storyframe.mjs, lang/en.json</files>
  <action>
Create storyframe.mjs as ESModule entry point:

```javascript
// Module constants
const MODULE_ID = 'storyframe';

// Hook: init (register settings, CONFIG)
Hooks.once('init', () => {
  console.log(`${MODULE_ID} | Initializing`);

  // Create namespace for module
  game.storyframe = {
    stateManager: null,
    socketManager: null
  };

  // Register settings (must be in init hook)
  game.settings.register(MODULE_ID, 'debug', {
    name: game.i18n.localize('STORYFRAME.Settings.Debug'),
    hint: game.i18n.localize('STORYFRAME.Settings.DebugHint'),
    scope: 'world',
    config: true,
    type: Boolean,
    default: false
  });
});

// Hook: setup (Documents available, settings readable)
Hooks.once('setup', () => {
  console.log(`${MODULE_ID} | Setup`);
  // StateManager initialized here in Plan 02
});

// Hook: socketlib.ready (register socket functions)
Hooks.once('socketlib.ready', () => {
  console.log(`${MODULE_ID} | Registering sockets`);
  // SocketManager initialized here in Plan 02
});

// Hook: ready (UI operations, everything loaded)
Hooks.once('ready', () => {
  console.log(`${MODULE_ID} | Ready`);
  // GM control button added in Phase 2
});
```

Create lang/en.json:
```json
{
  "STORYFRAME": {
    "Title": "StoryFrame",
    "Settings": {
      "Debug": "Debug Mode",
      "DebugHint": "Enable debug logging to console"
    }
  }
}
```

AVOID:
- Registering settings in setup/ready (must be init)
- Reading settings in init (not available yet)
- System-specific APIs (no system.* access)
  </action>
  <verify>
- File exists: `ls storyframe.mjs lang/en.json`
- Contains all four hooks: `grep -c "Hooks.once" storyframe.mjs` should return 4
- Contains MODULE_ID constant: `grep -q "MODULE_ID" storyframe.mjs`
- lang/en.json valid JSON: `cat lang/en.json | jq .`
  </verify>
  <done>
- storyframe.mjs exports nothing (side-effect module)
- Hooks registered: init, setup, socketlib.ready, ready
- Settings registered in init hook (not later)
- game.storyframe namespace created in init
- lang/en.json provides localization strings
  </done>
</task>

</tasks>

<verification>
Overall plan verification:
1. Module directory structure matches manifest references
2. All hooks fire in sequence when loaded (visible in console)
3. No console errors or warnings about deprecated fields
4. socketlib dependency declared (Foundry will prompt to install if missing)
</verification>

<success_criteria>
Requirements satisfied:
- FOUN-01: Module manifest valid (id, title, version, compatibility, JSON syntax)
- FOUN-02: Module initializes in correct hook sequence (init→setup→ready)
- FOUN-03: Module works with any Foundry system (no system-specific code)

Pitfalls prevented:
- Pitfall 1: Settings registered in init (not later)
- Pitfall 2: socketlib in relationships.requires
- Pitfall 7: No deprecated manifest fields
- Pitfall 8: No system-specific APIs
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
