---
phase: 07-premium-journal-css-scraper
plan: 04
type: execute
wave: 2
depends_on: ["07-03"]
files_modified: []
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "Kingmaker journals display with Kingmaker teal/gold styling"
    - "PFS journals display with PFS distinctive teal/turquoise sidebar"
    - "Switching between premium module journals updates CSS correctly"
    - "World journals (imported from packs) maintain original premium styling"
  artifacts: []
  key_links: []
---

<objective>
Visual verification that premium module CSS scraping now works correctly across all module types.

Purpose: Plans 01-03 implemented code fixes. This checkpoint verifies the visual outcome matches user expectations for Kingmaker, PFS, and world journal styling.

Output: Confirmed working premium module styling or detailed failure report for further gap closure.
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-premium-journal-css-scraper/07-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
CSS extraction timing fix and premium module stylesheet detection from rendered journal sheets.
  </what-built>
  <how-to-verify>
**Test 1: Kingmaker Journal Styling**
1. Open Foundry VTT with StoryFrame module enabled
2. Open StoryFrame (GM Interface)
3. Select a Kingmaker journal from the compendium (pf2e-kingmaker.kingmaker-journal-entries)
4. Verify:
   - Kingmaker teal/gold theme visible in journal content
   - Styling matches native Foundry journal appearance
   - Check console (F12): Should see "FOUND premium module stylesheet" and "Extracted class: pf2e-km"

**Test 2: PFS Journal Styling**
1. Select a PFS journal from compendium
2. Verify:
   - Distinctive teal/turquoise sidebar visible
   - PFS styling distinct from Kingmaker
   - Console shows appropriate class extraction

**Test 3: Journal Switching**
1. With Kingmaker journal open, switch to PFS journal
2. Verify:
   - Styling updates immediately
   - No Kingmaker colors persist
   - PFS styling replaces Kingmaker styling cleanly
3. Switch back to Kingmaker
4. Verify Kingmaker styling returns

**Test 4: World Journal Import**
1. Drag a Kingmaker journal from compendium to world (creates world copy)
2. Open the world copy in StoryFrame
3. Verify:
   - World journal retains Kingmaker styling
   - Console shows extractedClass is still detected correctly
   - Styling identical to compendium version

**Test 5: Console Diagnostics**
1. Open browser console (F12)
2. Filter by "CSSScraper" and "GMInterface"
3. Verify logs show:
   - "Extracted class: pf2e-km" (or other premium class) - NOT "none"
   - "FOUND premium module stylesheet: modules/pf2e-kingmaker-tools/..."
   - "Matched [50+] rules" (more than 6)
   - "Final CSS payload: [10-50KB]" (not 270KB)
  </how-to-verify>
  <resume-signal>
Type "approved" if all 5 tests pass.

If any test fails, provide:
- Which test(s) failed
- What you observed vs expected
- Console log excerpts if relevant
- Screenshot if helpful
  </resume-signal>
</task>

</tasks>

<verification>
All 5 visual tests pass:
1. Kingmaker journal displays correct teal/gold theme
2. PFS journal displays distinctive sidebar colors
3. Switching between journals updates styling correctly
4. World journals retain premium module styling
5. Console logs confirm correct extraction flow
</verification>

<success_criteria>
User confirms visual styling matches native journal appearance for:
- Kingmaker journals (teal/gold theme)
- PFS journals (teal/turquoise sidebar)
- World journals imported from premium compendiums
- Switching between journals updates CSS without stale styles
</success_criteria>

<output>
After completion, create `.planning/phases/07-premium-journal-css-scraper/07-04-SUMMARY.md`
</output>
