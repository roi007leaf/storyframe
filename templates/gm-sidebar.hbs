<div class="gm-sidebar-container">
  <!-- NPCs Section -->
  <div class="npcs-section">
    <div class="section-header">
      <h3>NPCs</h3>
      <div class="section-actions">
        <button type="button" data-action="addSpeakerFromImage" title="Add NPC from image">
          <i class="fas fa-plus"></i>
        </button>
        <button type="button" data-action="clearSpeaker" title="Clear active NPC">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <div class="speaker-gallery">
      {{#if hasSpeakers}}
        {{#each speakers}}
          <div class="speaker-thumbnail {{#if (eq ../activeSpeaker this.id)}}active{{/if}} {{#if this.actorDeleted}}deleted{{/if}}"
               data-action="setSpeaker"
               data-speaker-id="{{this.id}}"
               title="{{this.name}}{{#if this.actorDeleted}} (Actor Deleted){{/if}}">
            <img src="{{this.img}}" alt="{{this.name}}">
            <div class="speaker-name">{{this.name}}</div>
            <button type="button" class="remove-speaker" data-action="removeSpeaker" data-speaker-id="{{this.id}}" title="Remove">
              <i class="fas fa-times"></i>
            </button>
          </div>
        {{/each}}
      {{else}}
        <div class="empty-state">
          <p>No NPCs</p>
          <p>Drag actors here or use +</p>
        </div>
      {{/if}}
    </div>
  </div>

  <!-- PCs Section -->
  <div class="pcs-section {{#if pcsPanelCollapsed}}collapsed{{/if}}">
    <div class="section-header collapsible" data-action="togglePCsPanel">
      <h3>PCs</h3>
      <i class="fas {{#if pcsPanelCollapsed}}fa-chevron-down{{else}}fa-chevron-up{{/if}}"></i>
    </div>

    <div class="panel-content">
      <div class="participant-portraits" data-drop-zone="participant">
        {{#if hasParticipants}}
          {{#each participants}}
            <div class="participant-token {{#if this.selected}}selected{{/if}}"
                 data-action="toggleParticipantSelection"
                 data-participant-id="{{this.id}}"
                 data-tooltip="{{this.name}}">
              <img src="{{this.img}}" alt="{{this.name}}">
              <button type="button" class="remove-btn"
                      data-action="removeParticipant"
                      data-participant-id="{{this.id}}"
                      data-tooltip="Remove">
                <i class="fas fa-times"></i>
              </button>
            </div>
          {{/each}}
          <button type="button" class="add-btn" data-action="addAllPCs" data-tooltip="Add All PCs">
            <i class="fas fa-plus"></i>
          </button>
        {{else}}
          <button type="button" class="add-btn large" data-action="addAllPCs" data-tooltip="Add All PCs">
            <i class="fas fa-users"></i>
          </button>
          <span class="hint">Add PCs for skill checks</span>
        {{/if}}
      </div>

      {{#if hasParticipants}}
      <div class="check-request-bar">
        <div class="selection-info">
          <span class="count">{{selectedCount}}/{{participants.length}}</span>
          <button type="button" data-action="toggleSelectAll" class="link-btn">
            {{#if allSelected}}None{{else}}All{{/if}}
          </button>
        </div>

        <div class="dc-selector">
          <span class="label">DC</span>
          <select data-action="setDCSelect">
            <option value="" {{#unless currentDC}}selected{{/unless}}>--</option>
            <option value="10" {{#if (eq currentDC 10)}}selected{{/if}}>10</option>
            <option value="15" {{#if (eq currentDC 15)}}selected{{/if}}>15</option>
            <option value="20" {{#if (eq currentDC 20)}}selected{{/if}}>20</option>
            <option value="25" {{#if (eq currentDC 25)}}selected{{/if}}>25</option>
            <option value="30" {{#if (eq currentDC 30)}}selected{{/if}}>30</option>
          </select>
        </div>

        <div class="skill-actions">
          {{#each quickButtonSkills}}
            <button type="button"
                    class="skill-btn"
                    data-action="requestSkill"
                    data-skill="{{this.slug}}"
                    data-tooltip="{{this.name}}">
              {{this.shortName}}
            </button>
          {{/each}}
          <button type="button" class="skill-btn more" data-action="openSkillMenu" data-tooltip="All Skills">
            <i class="fas fa-ellipsis-h"></i>
          </button>
        </div>
      </div>
      {{/if}}
    </div>
  </div>

  <!-- Pending Rolls -->
  {{#if pendingRolls.length}}
  <div class="pending-rolls-section">
    <h4>Pending Requests</h4>
    {{#each pendingRolls}}
      <div class="pending-item">
        <span class="participant-name">{{this.participantName}}</span>
        <span class="skill-name">{{this.skillName}}</span>
        <button type="button" data-action="cancelRoll" data-request-id="{{this.id}}" title="Cancel">
          <i class="fas fa-times"></i>
        </button>
      </div>
    {{/each}}
  </div>
  {{/if}}
</div>
