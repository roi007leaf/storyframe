<div class="storyframe-container">
  <header class="storyframe-header">
    <div class="journal-selector">
      <label>Journal</label>
      <div class="custom-dropdown" data-dropdown="journal">
        <button type="button" class="dropdown-trigger" aria-haspopup="listbox" aria-expanded="false">
          <span class="dropdown-value">{{#if selectedJournalName}}{{selectedJournalName}}{{else}}-- Select Journal --{{/if}}</span>
          <i class="fas fa-chevron-down dropdown-arrow" aria-hidden="true"></i>
        </button>
        <div class="dropdown-menu" role="listbox" aria-label="Select journal">
          {{!-- Favorites section --}}
          {{#if journalFolders.favorites.length}}
            <div class="dropdown-section-header">
              <i class="fas fa-star" aria-hidden="true"></i>
              <span>Favorites</span>
            </div>
            {{#each journalFolders.favorites}}
              <div class="dropdown-item-wrapper favorite-item">
                <button type="button"
                        class="dropdown-item favorite-item {{#if (eq this.id ../selectedJournal)}}selected{{/if}}"
                        data-action="selectJournal"
                        data-value="{{this.id}}"
                        role="option"
                        aria-selected="{{#if (eq this.id ../selectedJournal)}}true{{else}}false{{/if}}">
                  <i class="fas fa-book-open" aria-hidden="true"></i>
                  <span>{{this.name}}</span>
                </button>
                <button type="button"
                        class="favorite-toggle active"
                        data-action="toggleFavorite"
                        data-journal-id="{{this.id}}"
                        data-tooltip="Remove from favorites">
                  <i class="fas fa-star" aria-hidden="true"></i>
                </button>
              </div>
            {{/each}}
            <div class="dropdown-divider"></div>
          {{/if}}
          {{!-- Folders and journals with depth-based indentation --}}
          {{#each journalFolders.items}}
            {{#if (eq this.type "folder")}}
              <button type="button"
                      class="dropdown-folder-item depth-{{this.depth}}"
                      data-action="toggleFolder"
                      data-folder-id="{{this.id}}">
                <i class="fas fa-chevron-right folder-icon" aria-hidden="true"></i>
                <i class="fas fa-folder folder-type-icon" aria-hidden="true"></i>
                <span class="folder-name">{{this.name}}</span>
              </button>
            {{else}}
              <div class="dropdown-item-wrapper depth-{{this.depth}}" data-folder-id="{{this.folderId}}">
                <button type="button"
                        class="dropdown-item {{#if (eq this.id ../selectedJournal)}}selected{{/if}}"
                        data-action="selectJournal"
                        data-value="{{this.id}}"
                        role="option"
                        aria-selected="{{#if (eq this.id ../selectedJournal)}}true{{else}}false{{/if}}">
                  <i class="fas fa-book-open" aria-hidden="true"></i>
                  <span>{{this.name}}</span>
                </button>
                <button type="button"
                        class="favorite-toggle {{#if this.isFavorite}}active{{/if}}"
                        data-action="toggleFavorite"
                        data-journal-id="{{this.id}}"
                        data-tooltip="{{#if this.isFavorite}}Remove from favorites{{else}}Add to favorites{{/if}}">
                  <i class="{{#if this.isFavorite}}fas{{else}}far{{/if}} fa-star" aria-hidden="true"></i>
                </button>
              </div>
            {{/if}}
          {{/each}}
          {{!-- Root-level journals --}}
          {{#each journalFolders.rootJournals}}
            <div class="dropdown-item-wrapper root-item">
              <button type="button"
                      class="dropdown-item root-item {{#if (eq this.id ../selectedJournal)}}selected{{/if}}"
                      data-action="selectJournal"
                      data-value="{{this.id}}"
                      role="option"
                      aria-selected="{{#if (eq this.id ../selectedJournal)}}true{{else}}false{{/if}}">
                <i class="fas fa-book-open" aria-hidden="true"></i>
                <span>{{this.name}}</span>
              </button>
              <button type="button"
                      class="favorite-toggle {{#if this.isFavorite}}active{{/if}}"
                      data-action="toggleFavorite"
                      data-journal-id="{{this.id}}"
                      data-tooltip="{{#if this.isFavorite}}Remove from favorites{{else}}Add to favorites{{/if}}">
                <i class="{{#if this.isFavorite}}fas{{else}}far{{/if}} fa-star" aria-hidden="true"></i>
              </button>
            </div>
          {{/each}}
        </div>
      </div>
    </div>
    <div class="header-actions">
      {{#if canGoBack}}
      <button type="button" data-action="goBack" data-tooltip="Go Back" aria-label="Go back to previous journal">
        <i class="fas fa-arrow-left" aria-hidden="true"></i>
      </button>
      {{/if}}
      {{#if selectedJournal}}
      <button type="button" data-action="editJournal" data-tooltip="Edit Journal" aria-label="Edit journal in native editor">
        <i class="fas fa-edit" aria-hidden="true"></i>
      </button>
      {{/if}}
      <button type="button" data-action="toggleSidebar" data-tooltip="Toggle Characters Sidebar" aria-label="Toggle characters sidebar">
        <i class="fas fa-users" aria-hidden="true"></i>
      </button>
    </div>
  </header>

  <div class="two-column-layout">
  <!-- Left: Page TOC -->
  <nav class="page-toc" aria-label="Page navigation">
    <div class="toc-header">
      <input type="search"
             name="page-search"
             placeholder="Search pages..."
             autocomplete="off"
             aria-label="Search pages">
    </div>
    <div class="page-list" role="listbox" aria-label="Journal pages">
      {{#if pages.length}}
        {{#each pages}}
          <div class="page-item level{{this.level}} {{#if (eq @index ../currentPageIndex)}}selected{{/if}}"
               data-action="selectPage"
               data-page-index="{{@index}}"
               data-tooltip="{{this.name}}"
               role="option"
               tabindex="0"
               aria-selected="{{#if (eq @index ../currentPageIndex)}}true{{else}}false{{/if}}">
            <span class="page-name">{{this.name}}</span>
          </div>
        {{/each}}
      {{else}}
        <div class="empty-state" role="status">
          {{#if selectedJournal}}
            <p>No pages found</p>
          {{else}}
            <p>Select a journal above</p>
          {{/if}}
        </div>
      {{/if}}
    </div>
  </nav>

  <!-- Middle: Content Area -->
  <main class="content-area journal-entry-content flexcol" aria-label="Journal content">
    {{#if currentPageContent}}
      <!-- Module classes only on the journal content wrapper -->
      <div class="journal-entry-pages single-page journal-sheet journal-entry themed theme-light {{containerClasses}}">
        <div class="scrollable">
          <article class="journal-entry-page {{pageType}} {{#if pageLevel}}level{{pageLevel}}{{/if}}" data-page-type="{{pageType}}">
            <header class="journal-page-header">
              {{#if (eq pageLevel 1)}}
                <h1>{{currentPageName}}</h1>
              {{else}}
                <h2>{{currentPageName}}</h2>
              {{/if}}
            </header>
            <section class="journal-page-content">
              {{{currentPageContent}}}
            </section>
          </article>
        </div>
      </div>
    {{else}}
      <div class="empty-state" role="status">
        <p>No page selected</p>
        <p>Select a journal and page to view content</p>
      </div>
    {{/if}}
  </main>
</div>
</div>
